<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Living Economy Arena - Enhanced Storytelling Experience</title>
    <meta name="description" content="Experience the Living Economy through 500 AI agents with immersive storytelling">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E🎭%3C/text%3E%3C/svg%3E">
    
    <style>
        /* Enhanced styling for storytelling experience */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            overflow: hidden;
        }
        
        /* Loading screen with storytelling theme */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.8s ease-out;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-logo {
            font-size: 5rem;
            margin-bottom: 2rem;
            animation: storytelling-pulse 3s ease-in-out infinite;
        }
        
        .loading-title {
            font-size: 3rem;
            font-weight: 300;
            background: linear-gradient(135deg, #00ff88 0%, #00d2ff 50%, #ffd93d 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .loading-subtitle {
            font-size: 1.4rem;
            color: #aaa;
            margin-bottom: 3rem;
            text-align: center;
        }
        
        .loading-progress {
            width: 500px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 2rem;
            position: relative;
        }
        
        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, #00ff88 0%, #00d2ff 50%, #ffd93d 100%);
            border-radius: 3px;
            width: 0%;
            transition: width 0.4s ease;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.6);
        }
        
        .loading-status {
            font-size: 1.1rem;
            color: #00ff88;
            min-height: 2rem;
            text-align: center;
            animation: status-glow 2s ease-in-out infinite alternate;
        }
        
        .loading-features {
            position: absolute;
            bottom: 4rem;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: #666;
            max-width: 1000px;
        }
        
        .loading-features h3 {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            color: #888;
            background: linear-gradient(135deg, #00ff88 0%, #00d2ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            max-width: 1200px;
        }
        
        .feature-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.8rem;
            font-size: 0.95rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }
        
        .feature-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(0, 255, 136, 0.3);
            transform: translateY(-2px);
        }
        
        .feature-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .feature-title {
            font-weight: 600;
            color: #00d2ff;
            margin-bottom: 0.5rem;
        }
        
        .feature-description {
            color: #888;
            text-align: center;
            font-size: 0.85rem;
            line-height: 1.4;
        }
        
        @keyframes storytelling-pulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            33% { transform: scale(1.05) rotate(2deg); }
            66% { transform: scale(1.02) rotate(-1deg); }
        }
        
        @keyframes status-glow {
            0% { color: #00ff88; text-shadow: 0 0 10px rgba(0, 255, 136, 0.5); }
            100% { color: #00d2ff; text-shadow: 0 0 15px rgba(0, 210, 255, 0.7); }
        }
        
        /* Enhanced error handling */
        .error-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a0000 0%, #2a0a0a 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10001;
        }
        
        .error-screen.visible {
            display: flex;
        }
        
        .error-icon {
            font-size: 5rem;
            color: #ff4444;
            margin-bottom: 2rem;
            animation: error-shake 0.5s ease-in-out infinite alternate;
        }
        
        .error-title {
            font-size: 2.5rem;
            color: #ff4444;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .error-message {
            font-size: 1.2rem;
            color: #ffaaaa;
            text-align: center;
            max-width: 700px;
            margin-bottom: 3rem;
            line-height: 1.6;
        }
        
        .error-actions {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .error-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .error-btn:hover {
            background: linear-gradient(135deg, #ff6666 0%, #ff8888 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 68, 68, 0.4);
        }
        
        @keyframes error-shake {
            0% { transform: translateX(0); }
            100% { transform: translateX(-2px); }
        }
        
        /* Success transition */
        .success-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .success-transition.visible {
            display: flex;
        }
        
        .success-message {
            text-align: center;
            color: #00ff88;
            font-size: 2rem;
            animation: success-fade 2s ease-in-out;
        }
        
        @keyframes success-fade {
            0% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1.1); }
            100% { opacity: 0; transform: scale(1); }
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .loading-title {
                font-size: 2rem;
            }
            
            .loading-subtitle {
                font-size: 1.1rem;
            }
            
            .loading-progress {
                width: 300px;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .feature-item {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">🎭</div>
        <h1 class="loading-title">Living Economy Arena</h1>
        <div class="loading-subtitle">Enhanced Storytelling Experience</div>
        
        <div class="loading-progress">
            <div class="loading-bar" id="loadingBar"></div>
        </div>
        <div class="loading-status" id="loadingStatus">Initializing storytelling experience...</div>
        
        <div class="loading-features">
            <h3>🎨 Storytelling Features</h3>
            <div class="feature-grid">
                <div class="feature-item">
                    <div class="feature-icon">📖</div>
                    <div class="feature-title">Economic Narratives</div>
                    <div class="feature-description">Real-time stories generated from AI agent decisions and market events</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">👤</div>
                    <div class="feature-title">Agent Biographies</div>
                    <div class="feature-description">Character development cards with unique personalities and growth stories</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">🔄</div>
                    <div class="feature-title">Supply Chain Flows</div>
                    <div class="feature-description">Animated visualization of goods, services, and money flowing through the economy</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">🧠</div>
                    <div class="feature-title">AI Reasoning Display</div>
                    <div class="feature-description">Thought bubbles showing real-time AI decision-making processes</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">⏱️</div>
                    <div class="feature-title">Events Timeline</div>
                    <div class="feature-description">Economic milestones and turning points tracked over time</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">🌊</div>
                    <div class="feature-title">Impact Ripples</div>
                    <div class="feature-description">Cause-and-effect propagation visualization of economic decisions</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">🕸️</div>
                    <div class="feature-title">Agent Networks</div>
                    <div class="feature-description">Dynamic trading partner connections and relationship mapping</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">🤖</div>
                    <div class="feature-title">500 AI Agents</div>
                    <div class="feature-description">Real AI agents making authentic economic decisions with OpenRouter integration</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Error Screen -->
    <div class="error-screen" id="errorScreen">
        <div class="error-icon">❌</div>
        <h2 class="error-title">Storytelling System Error</h2>
        <div class="error-message" id="errorMessage">
            The enhanced storytelling system encountered an error during initialization. 
            Please ensure your browser supports modern web technologies and try again.
        </div>
        <div class="error-actions">
            <button class="error-btn" onclick="window.location.reload()">🔄 Retry</button>
            <button class="error-btn" onclick="showCompatibilityInfo()">ℹ️ System Info</button>
            <button class="error-btn" onclick="switchToBasicMode()">📊 Basic Mode</button>
        </div>
    </div>
    
    <!-- Success Transition -->
    <div class="success-transition" id="successTransition">
        <div class="success-message">
            🎭 Storytelling Experience Ready!
        </div>
    </div>
    
    <!-- Main Application Script -->
    <script type="module">
        // Enhanced loading management
        let loadingProgress = 0;
        const loadingSteps = [
            { step: 10, message: 'Checking storytelling compatibility...' },
            { step: 20, message: 'Loading narrative generation engine...' },
            { step: 30, message: 'Initializing agent biography system...' },
            { step: 40, message: 'Setting up supply chain animations...' },
            { step: 50, message: 'Creating AI reasoning displays...' },
            { step: 60, message: 'Building events timeline...' },
            { step: 70, message: 'Configuring impact ripples...' },
            { step: 80, message: 'Establishing agent networks...' },
            { step: 90, message: 'Connecting to 500 AI agents...' },
            { step: 100, message: 'Storytelling experience ready!' }
        ];
        
        function updateLoading(progress, message) {
            const loadingBar = document.getElementById('loadingBar');
            const loadingStatus = document.getElementById('loadingStatus');
            
            if (loadingBar) {
                loadingBar.style.width = `${progress}%`;
                loadingBar.style.boxShadow = `0 0 ${Math.min(30, progress)}px rgba(0, 255, 136, 0.6)`;
            }
            if (loadingStatus) loadingStatus.textContent = message;
        }
        
        function showSuccess() {
            const successTransition = document.getElementById('successTransition');
            if (successTransition) {
                successTransition.classList.add('visible');
                setTimeout(() => {
                    successTransition.classList.remove('visible');
                }, 2000);
            }
        }
        
        function hideLoading() {
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) {
                loadingScreen.classList.add('hidden');
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 800);
            }
        }
        
        function showError(message) {
            const errorScreen = document.getElementById('errorScreen');
            const errorMessage = document.getElementById('errorMessage');
            const loadingScreen = document.getElementById('loadingScreen');
            
            if (errorMessage) errorMessage.textContent = message;
            if (errorScreen) errorScreen.classList.add('visible');
            if (loadingScreen) loadingScreen.style.display = 'none';
        }
        
        function showCompatibilityInfo() {
            const info = `
🎭 Enhanced Storytelling System Requirements:

Browser Compatibility:
• WebGL 2.0 support (for advanced visualizations)
• Canvas 2D context support (for animations)
• WebSocket support (for real-time data)
• ES2021+ JavaScript support
• CSS Grid and Flexbox support

Current Browser Capabilities:
• WebGL: ${!!window.WebGLRenderingContext ? '✅ Supported' : '❌ Not Supported'}
• WebGL2: ${!!window.WebGL2RenderingContext ? '✅ Supported' : '❌ Not Supported'}
• Canvas: ${!!document.createElement('canvas').getContext ? '✅ Supported' : '❌ Not Supported'}
• WebSocket: ${!!window.WebSocket ? '✅ Supported' : '❌ Not Supported'}
• Performance API: ${!!window.performance ? '✅ Supported' : '❌ Not Supported'}

🎨 Storytelling Features:
• Real-time narrative generation
• Agent biography cards
• Supply chain animations
• AI reasoning displays
• Impact ripple effects
• Relationship networks

For optimal storytelling experience, use:
• Chrome 100+ (recommended)
• Firefox 100+
• Safari 15+
• Edge 100+

🤖 AI Agent System:
• 500 real AI agents
• OpenRouter integration
• Real-time decision making
• Market dynamics simulation
            `;
            alert(info);
        }
        
        function switchToBasicMode() {
            if (confirm('Switch to basic dashboard without storytelling features?')) {
                window.location.href = 'index.html';
            }
        }
        
        async function initializeStorytellingSystem() {
            try {
                // Enhanced compatibility check
                updateLoading(10, 'Checking storytelling compatibility...');
                
                const compatibilityIssues = [];
                if (!window.WebGLRenderingContext) compatibilityIssues.push('WebGL not supported');
                if (!window.WebSocket) compatibilityIssues.push('WebSocket not supported');
                if (!document.createElement('canvas').getContext) compatibilityIssues.push('Canvas not supported');
                
                if (compatibilityIssues.length > 0) {
                    console.warn('Compatibility issues detected:', compatibilityIssues.join(', '));
                }
                
                // Simulate enhanced loading steps
                for (const { step, message } of loadingSteps) {
                    updateLoading(step, message);
                    await new Promise(resolve => setTimeout(resolve, 300 + Math.random() * 400));
                }
                
                // Load the enhanced storytelling system
                await new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = './enhanced_storytelling_system.js';
                    script.onload = () => {
                        console.log('✅ Enhanced storytelling system loaded');
                        resolve();
                    };
                    script.onerror = (error) => {
                        console.error('❌ Failed to load storytelling system:', error);
                        reject(error);
                    };
                    document.head.appendChild(script);
                });
                
                // Wait for script execution
                await new Promise(resolve => setTimeout(resolve, 200));
                
                // Initialize the storytelling system
                const EnhancedStorytellingSystem = window.EnhancedStorytellingSystem;
                if (!EnhancedStorytellingSystem) {
                    throw new Error('Enhanced storytelling system not found');
                }
                
                updateLoading(95, 'Initializing storytelling experience...');
                
                const storytellingSystem = new EnhancedStorytellingSystem();
                await storytellingSystem.initialize();
                await storytellingSystem.start();
                
                // Make globally accessible
                window.storytellingSystem = storytellingSystem;
                
                updateLoading(100, 'Storytelling experience ready!');
                
                // Show success transition
                showSuccess();
                
                // Hide loading screen
                setTimeout(() => {
                    hideLoading();
                    console.log('🎭 Living Economy Enhanced Storytelling Experience is ready!');
                    console.log('🔗 Access system via window.storytellingSystem');
                }, 1000);
                
            } catch (error) {
                console.error('❌ Storytelling system initialization failed:', error);
                showError(`Storytelling system initialization failed: ${error.message}`);
            }
        }
        
        // Global error handling
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            showError(`JavaScript Error: ${event.message}`);
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
            showError(`Promise Rejection: ${event.reason}`);
        });
        
        // Start initialization when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeStorytellingSystem);
        } else {
            initializeStorytellingSystem();
        }
        
        // Enhanced keyboard shortcuts
        document.addEventListener('keydown', (event) => {
            if (event.ctrlKey || event.metaKey) {
                switch (event.key) {
                    case 's':
                        event.preventDefault();
                        if (window.storytellingSystem) {
                            console.log('📊 System Status:', window.storytellingSystem.getSystemStatus());
                        }
                        break;
                    case 'r':
                        event.preventDefault();
                        window.location.reload();
                        break;
                    case 'b':
                        event.preventDefault();
                        switchToBasicMode();
                        break;
                    case 'h':
                        event.preventDefault();
                        showCompatibilityInfo();
                        break;
                }
            }
        });
        
        // Prevent context menu for immersive experience
        document.addEventListener('contextmenu', (event) => {
            event.preventDefault();
        });
        
        // Performance monitoring
        if (window.performance) {
            window.addEventListener('load', () => {
                setTimeout(() => {
                    const perfData = window.performance.getEntriesByType('navigation')[0];
                    console.log('🚀 Page loaded in', Math.round(perfData.loadEventEnd - perfData.fetchStart), 'ms');
                }, 0);
            });
        }
    </script>
</body>
</html>